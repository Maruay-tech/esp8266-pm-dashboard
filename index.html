
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PM2230 Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; }
    h2 { color: #333; }
    canvas { max-width: 100%; height: 300px; margin-top: 20px; }
    .btn { padding: 10px 15px; margin: 10px; background: #28a745; color: white; border: none; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>ðŸ“Š PM2230 Dashboard</h2>
  <div>
    <button class="btn" onclick="setRelay(true)">Relay ON</button>
    <button class="btn" style="background:#dc3545" onclick="setRelay(false)">Relay OFF</button>
    <span id="relayState">Relay: OFF</span>
  </div>
  <canvas id="chartLN"></canvas>
  <canvas id="chartLL"></canvas>

<script>
let chartLN, chartLL;
const ctxLN = document.getElementById('chartLN').getContext('2d');
const ctxLL = document.getElementById('chartLL').getContext('2d');

function safe(v) {
  return (v === -9999 || v == null) ? null : parseFloat(v.toFixed(2));
}

function fetchData() {
  fetch("https://raw.githubusercontent.com/Maruay-tech/esp8266-pm-dashboard/main/data/data.json")
  .then(res => res.json()).then(data => {
    document.getElementById("relayState").textContent = "Relay: " + data.relay;

    chartLN.data.datasets[0].data = [safe(data.v1n), safe(data.v2n), safe(data.v3n), safe(data.vavg)];
    chartLL.data.datasets[0].data = [safe(data.v12), safe(data.v23), safe(data.v31), safe(data.vllavg)];

    chartLN.update();
    chartLL.update();
  });
}

function setRelay(on) {
  alert("Relay control not available via GitHub Pages!");
}

chartLN = new Chart(ctxLN, {
  type: 'bar',
  data: {
    labels: ['L1-N', 'L2-N', 'L3-N', 'LN Avg'],
    datasets: [{
      label: 'Voltage L-N (V)',
      data: [0,0,0,0],
      backgroundColor: '#007bff'
    }]
  },
  options: { responsive: true, scales: { y: { beginAtZero: true } } }
});

chartLL = new Chart(ctxLL, {
  type: 'bar',
  data: {
    labels: ['L1-L2', 'L2-L3', 'L3-L1', 'LL Avg'],
    datasets: [{
      label: 'Voltage L-L (V)',
      data: [0,0,0,0],
      backgroundColor: '#fd7e14'
    }]
  },
  options: { responsive: true, scales: { y: { beginAtZero: true } } }
});

setInterval(fetchData, 5000);
</script>
</body>
</html>
